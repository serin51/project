local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local lp = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Window = Rayfield:CreateWindow({
    Name = "ZortSaken",
    LoadingTitle = "ZortSaken",
    LoadingSubtitle = "meow meow zort zort",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = "ZortSaken",
        FileName = "Config"
    },
    Discord = { Enabled = false },
    KeySystem = false
})

local espTab = Window:CreateTab("Esp", 6031099652)
espTab:CreateSection("Highlight Esp")

local StaminaMod = Window:CreateTab("Stamina Modification", 6035047408)
StaminaMod:CreateSection("Stamina modification")

local SurvivorsTab = Window:CreateTab("Survivors", 6031099652)
local KillersTab = Window:CreateTab("Killers")
KillersTab:CreateSection("Slasher")

local espFunc = false
local highlights = {}

getgenv().Colors = {
    Survivor = Color3.fromRGB(0,170,255),
    Killer = Color3.fromRGB(255,0,0),
    Gen = Color3.fromRGB(170,0,255),
    GenDone = Color3.fromRGB(0,255,100),
    FakeGen = Color3.fromRGB(255,100,100),
    Item = Color3.fromRGB(255,255,0)
}

local KillersFolder = Workspace:WaitForChild("Players"):WaitForChild("Killers")

local function getHighlight(obj)
    local h = highlights[obj]
    if not h then
        h = Instance.new("Highlight")
        h.Adornee = obj
        h.FillTransparency = 0.5
        h.OutlineTransparency = 0.9
        h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        h.Parent = obj
        highlights[obj] = h
    end
    return h
end

espTab:CreateToggle({
    Name = "Enable Esp",
    CurrentValue = false,
    Callback = function(v)
        espFunc = v
    end
})

espTab:CreateColorPicker({
    Name = "Survivor color",
    Color = getgenv().Colors.Survivor,
    Callback = function(c)
        getgenv().Colors.Survivor = c
    end
})

espTab:CreateColorPicker({
    Name = "Killer color",
    Color = getgenv().Colors.Killer,
    Callback = function(c)
        getgenv().Colors.Killer = c
    end
})

espTab:CreateColorPicker({
    Name = "Gen color",
    Color = getgenv().Colors.Gen,
    Callback = function(c)
        getgenv().Colors.Gen = c
    end
})

espTab:CreateColorPicker({
    Name = "Gen done Color",
    Color = getgenv().Colors.GenDone,
    Callback = function(c)
        getgenv().Colors.GenDone = c
    end
})

espTab:CreateColorPicker({
    Name = "Fake gen Color",
    Color = getgenv().Colors.FakeGen,
    Callback = function(c)
        getgenv().Colors.FakeGen = c
    end
})

espTab:CreateColorPicker({
    Name = "Item color",
    Color = getgenv().Colors.Item,
    Callback = function(c)
        getgenv().Colors.Item = c
    end
})

RunService.RenderStepped:Connect(function()
    if not espFunc then
        for _, h in pairs(highlights) do
            h.Enabled = false
        end
        return
    end

    for obj, h in pairs(highlights) do
        if not obj or not obj.Parent then
            h:Destroy()
            highlights[obj] = nil
        end
    end

    for _, killer in pairs(KillersFolder:GetChildren()) do
        if killer:FindFirstChild("HumanoidRootPart") then
            local h = getHighlight(killer)
            h.FillColor = getgenv().Colors.Killer
            h.OutlineColor = getgenv().Colors.Killer
            h.Enabled = true
        end
    end

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= lp then
            local char = plr.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local isInKillersFolder = KillersFolder:FindFirstChild(char.Name)
                if not isInKillersFolder then
                    local h = getHighlight(char)
                    h.FillColor = getgenv().Colors.Survivor
                    h.OutlineColor = getgenv().Colors.Survivor
                    h.Enabled = true
                end
            end
        end
    end

    local map = Workspace:FindFirstChild("Map")
    if map and map:FindFirstChild("Ingame") and map.Ingame:FindFirstChild("Map") then
        for _, obj in pairs(map.Ingame.Map:GetChildren()) do
            if obj.Name == "Generator" or obj.Name == "FakeGenerator" then
                local h = getHighlight(obj)
                if obj.Name == "FakeGenerator" then
                    h.FillColor = getgenv().Colors.FakeGen
                elseif obj:FindFirstChild("Progress") and obj.Progress.Value >= 100 then
                    h.FillColor = getgenv().Colors.GenDone
                else
                    h.FillColor = getgenv().Colors.Gen
                end
                h.OutlineColor = h.FillColor
                h.Enabled = true
            end
        end
    end

    for _, item in pairs(Workspace:GetDescendants()) do
        if item.Name == "ItemRoot" and item:IsA("BasePart") then
            local h = getHighlight(item)
            h.FillColor = getgenv().Colors.Item
            h.OutlineColor = getgenv().Colors.Item
            h.Enabled = true
        end
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if plr.Character and highlights[plr.Character] then
        highlights[plr.Character]:Destroy()
        highlights[plr.Character] = nil
    end
end)

local maxStamina = 100
local minStamina = 0
local staminaGain = 20
local staminaLoss = 10
local sprintSpeed = 26
local staminaLossDisabled = false

StaminaMod:CreateInput({
    Name = "Max stamina",
    PlaceholderText = "100",
    CurrentValue = "100",
    RemoveTextAfterFocusLost = false,
    Callback = function(t)
        maxStamina = tonumber(t) or maxStamina
    end
})

StaminaMod:CreateInput({
    Name = "Min stamina",
    PlaceholderText = "0",
    CurrentValue = "0",
    RemoveTextAfterFocusLost = false,
    Callback = function(t)
        minStamina = tonumber(t) or minStamina
    end
})

StaminaMod:CreateInput({
    Name = "Stamina gain per sec",
    PlaceholderText = "20",
    CurrentValue = "20",
    RemoveTextAfterFocusLost = false,
    Callback = function(t)
        staminaGain = tonumber(t) or staminaGain
    end
})

StaminaMod:CreateInput({
    Name = "Stamina loss per sec",
    PlaceholderText = "10",
    CurrentValue = "10",
    RemoveTextAfterFocusLost = false,
    Callback = function(t)
        staminaLoss = tonumber(t) or staminaLoss
    end
})

StaminaMod:CreateInput({
    Name = "Sprint speed",
    PlaceholderText = "26",
    CurrentValue = "26",
    RemoveTextAfterFocusLost = false,
    Callback = function(t)
        sprintSpeed = tonumber(t) or sprintSpeed
    end
})

StaminaMod:CreateToggle({
    Name = "Inf stamina",
    CurrentValue = false,
    Callback = function(v)
        staminaLossDisabled = v
    end
})

task.spawn(function()
    local stamina = require(ReplicatedStorage.Systems.Character.Game.Sprinting)
    while task.wait() do
        stamina.MaxStamina = maxStamina
        stamina.MinStamina = minStamina
        stamina.StaminaGain = staminaGain
        stamina.StaminaLoss = staminaLossDisabled and 0 or staminaLoss
        stamina.SprintSpeed = sprintSpeed
        stamina.StaminaLossDisabled = staminaLossDisabled
    end
end)

SurvivorsTab:CreateSection("Veeronica")

local veeronicaTrickEnabled = false
local VIM = game:GetService("VirtualInputManager")
local behaviorFolder = ReplicatedStorage:WaitForChild("Assets"):WaitForChild("Survivors"):WaitForChild("Veeronica"):WaitForChild("Behavior")
local activeMonitors = {}
local descendantConn = nil

local function getSprintingButton()
    return lp.PlayerGui:FindFirstChild("MainUI") and lp.PlayerGui.MainUI:FindFirstChild("SprintingButton")
end

local function pressSprint()
    if UserInputService.TouchEnabled then
        local btn = getSprintingButton()
        if btn then
            for _, conn in pairs(getconnections(btn.MouseButton1Down)) do
                pcall(conn.Fire, conn)
            end
        end
    else
        VIM:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
        task.wait(0.05)
        VIM:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
    end
end

local function monitorHighlight(highlight)
    if not highlight or activeMonitors[highlight] then return end
    local connections = {}
    local wasOnPlayer = false

    local function cleanup()
        for _, c in ipairs(connections) do
            if c.Connected then c:Disconnect() end
        end
        activeMonitors[highlight] = nil
    end

    local function check()
        if not veeronicaTrickEnabled or not highlight.Parent then
            cleanup()
            return
        end
        local char = lp.Character
        if not char then return end
        local onPlayer = highlight.Adornee and (highlight.Adornee == char or highlight.Adornee:IsDescendantOf(char))
        if onPlayer and not wasOnPlayer then pressSprint() end
        wasOnPlayer = onPlayer
    end

    table.insert(connections, highlight:GetPropertyChangedSignal("Adornee"):Connect(check))
    table.insert(connections, highlight.AncestryChanged:Connect(check))
    table.insert(connections, lp.CharacterAdded:Connect(check))
    table.insert(connections, lp.CharacterRemoving:Connect(check))
    activeMonitors[highlight] = cleanup
    task.spawn(check)
end

local function startVeeronicaTrick()
    if descendantConn then return end
    for _, obj in behaviorFolder:GetDescendants() do
        if obj:IsA("Highlight") then
            monitorHighlight(obj)
        end
    end
    descendantConn = behaviorFolder.DescendantAdded:Connect(function(child)
        if child:IsA("Highlight") then
            task.wait()
            monitorHighlight(child)
        end
    end)
end

local function stopVeeronicaTrick()
    if descendantConn then
        descendantConn:Disconnect()
        descendantConn = nil
    end
    for _, cleanup in pairs(activeMonitors) do
        pcall(cleanup)
    end
    activeMonitors = {}
end

SurvivorsTab:CreateToggle({
    Name = "Vee auto trick",
    CurrentValue = false,
    Callback = function(v)
        veeronicaTrickEnabled = v
        if v then startVeeronicaTrick() else stopVeeronicaTrick() end
    end
})

local antiTab = Window:CreateTab("Antis")

antiTab:CreateSection("Anti-effects")

getgenv().Lighting = game:GetService("Lighting")
getgenv().Workspace = game:GetService("Workspace")
getgenv().removeEffectsEnabled = false
getgenv().lightingConnection = nil
getgenv().workspaceConnection = nil
getgenv().lightingTargets = {
    "BlindnessBlur",
    "SubspaceVFXBlur",
    "SubspaceVFXColorCorrection"
}
getgenv().workspaceTargets = {
    "GlitchParts"
}
getgenv().removeLightingInstances = function()
    for _, name in ipairs(getgenv().lightingTargets) do
        local obj = getgenv().Lighting:FindFirstChild(name)
        if obj then
            obj:Destroy()
        end
    end
end
getgenv().removeWorkspaceInstances = function()
    for _, name in ipairs(getgenv().workspaceTargets) do
        local obj = getgenv().Workspace:FindFirstChild(name)
        if obj then
            obj:Destroy()
        end
    end
end
getgenv().enableRemoveEffects = function()
    getgenv().removeLightingInstances()
    getgenv().removeWorkspaceInstances()
    getgenv().lightingConnection = getgenv().Lighting.ChildAdded:Connect(function(child)
        if table.find(getgenv().lightingTargets, child.Name) then
            child:Destroy()
        end
    end)
    getgenv().workspaceConnection = getgenv().Workspace.ChildAdded:Connect(function(child)
        if table.find(getgenv().workspaceTargets, child.Name) then
            child:Destroy()
        end
    end)
    getgenv().removeEffectsEnabled = true
end
getgenv().disableRemoveEffects = function()
    if getgenv().lightingConnection then
        getgenv().lightingConnection:Disconnect()
        getgenv().lightingConnection = nil
    end
    if getgenv().workspaceConnection then
        getgenv().workspaceConnection:Disconnect()
        getgenv().workspaceConnection = nil
    end
    getgenv().removeEffectsEnabled = false
end
antiTab:CreateToggle({
    Name = "Anti blindness",
    CurrentValue = false,
    Flag = "RemoveBlindness",
    Callback = function(value)
        if value then
            getgenv().enableRemoveEffects()
        else
            getgenv().disableRemoveEffects()
        end
    end
})

local Survivors = workspace:WaitForChild("Players"):WaitForChild("Survivors")
local AntiSlowConfigs = {
    Slowness = {Values = {"SlowedStatus"}, Connection = nil, Enabled = false},
    Skills = {Values = {"StunningKiller", "EatFriedChicken", "GuestBlocking", "PunchAbility", "SubspaceTripmine",
                        "TaphTripwire", "PlasmaBeam", "SpawnProtection", "c00lgui", "ShootingGun",
                        "TwoTimeStab", "TwoTimeCrouching", "DrinkingCola", "DrinkingSlateskin",
                        "SlateskinStatus", "EatingGhostburger"}, Connection = nil, Enabled = false},
    Items = {Values = {"BloxyColaItem", "Medkit"}, Connection = nil, Enabled = false},
    Emotes = {Values = {"Emoting"}, Connection = nil, Enabled = false},
    Builderman = {Values = {"DispenserConstruction", "SentryConstruction"}, Connection = nil, Enabled = false}
}
local function hideSlownessUI()
    local mainUI = game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("MainUI")
    if mainUI then
        local statusContainer = mainUI:FindFirstChild("StatusContainer")
        if statusContainer then
            local slownessUI = statusContainer:FindFirstChild("Slowness")
            if slownessUI then
                slownessUI.Visible = false
            end
        end
    end
end
local function handleAntiSlow(survivor, config)
    if survivor:GetAttribute("Username") ~= game:GetService("Players").LocalPlayer.Name then return end
    local function onRenderStep()
        if not survivor.Parent or not config.Enabled then return end
        local speedMultipliers = survivor:FindFirstChild("SpeedMultipliers")
        if speedMultipliers then
            for _, valName in ipairs(config.Values) do
                local val = speedMultipliers:FindFirstChild(valName)
                if val and val:IsA("NumberValue") and val.Value ~= 1 then
                    val.Value = 1
                end
            end
        end
        hideSlownessUI()
    end
    config.Connection = RunService.RenderStepped:Connect(onRenderStep)
end
local function startAntiSlow(config)
    config.Enabled = true
    for _, survivor in pairs(Survivors:GetChildren()) do
        handleAntiSlow(survivor, config)
    end
    Survivors.ChildAdded:Connect(function(child)
        task.wait(0.1)
        handleAntiSlow(child, config)
    end)
end
local function stopAntiSlow(config)
    config.Enabled = false
    if config.Connection then
        config.Connection:Disconnect()
        config.Connection = nil
    end
end
for name, config in pairs(AntiSlowConfigs) do
    antiTab:CreateToggle({
        Name = "Anti slowness (all) " .. name,
        CurrentValue = false,
        Flag = "AntiSlow" .. name,
        Callback = function(value)
            if value then
                startAntiSlow(config)
            else
                stopAntiSlow(config)
            end
        end
    })

local savedRangeRaging = Players.LocalPlayer:FindFirstChild("RagingPaceRange")
if not savedRangeRaging then
    savedRangeRaging = Instance.new("NumberValue")
    savedRangeRaging.Name = "RagingPaceRange"
    savedRangeRaging.Value = 19
    savedRangeRaging.Parent = Players.LocalPlayer
end
local savedRange404 = Players.LocalPlayer:FindFirstChild("Error404Range")
if not savedRange404 then
    savedRange404 = Instance.new("NumberValue")
    savedRange404.Name = "Error404Range"
    savedRange404.Value = 19
    savedRange404.Parent = Players.LocalPlayer
end
local savedRangeCorrupt = Players.LocalPlayer:FindFirstChild("CorruptEnergyRange")
if not savedRangeCorrupt then
    savedRangeCorrupt = Instance.new("NumberValue")
    savedRangeCorrupt.Name = "CorruptEnergyRange"
    savedRangeCorrupt.Value = 19
    savedRangeCorrupt.Parent = Players.LocalPlayer
end
local RANGE_RAGING = savedRangeRaging.Value
local RANGE_404 = savedRange404.Value
local RANGE_CORRUPT = savedRangeCorrupt.Value
local SPAM_DURATION = 3
local COOLDOWN_TIME = 5
local activeCooldownsRaging = {}
local activeCooldowns404 = {}
local activeCooldownsCorrupt = {}
local enabledRaging = false
local enabled404 = false
local enabledCorrupt = false
local animsToDetectRaging = {
    ["72722244508749"] = false,
    ["77448521277146"] = true,
    ["86096387000557"] = true,
    ["86371356500204"] = true,
    ["86545133269813"] = true,
    ["86709774283672"] = true,
    ["87259391926321"] = true,
    ["89448354637442"] = true,
    ["96959123077498"] = false,
    ["103601716322988"] = true,
    ["108807732150251"] = true,
    ["115194624791339"] = true,
    ["116618003477002"] = true,
    ["119462383658044"] = true,
    ["121255898612475"] = true,
    ["131696603025265"] = true,
    ["133491532453922"] = true,
    ["136007065400978"] = true,
    ["138040001965654"] = true,
    ["140703210927645"] = true,
}
local animsToDetect404 = animsToDetectRaging
local animsToDetectCorrupt = animsToDetectRaging
local function fireSkill(skillName)
    local args = {"UseActorAbility", { buffer.fromstring("\""..skillName.."\"")}}
    ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Network"):WaitForChild("RemoteEvent"):FireServer(unpack(args))
end
local function isAnimationMatching(anim, animTable)
    if not anim or not anim.Animation then
        return false
    end
    local id = anim.Animation.AnimationId
    if type(id) ~= "string" then
        return false
    end
    local numId = id:match("%d+")
    if not numId then
        return false
    end
    return animTable[numId] == true
end
local function detectAndSpam(skillName, range, cooldownTable, animTable)
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = player.Character.HumanoidRootPart
            local myChar = Players.LocalPlayer.Character
            if myChar and myChar:FindFirstChild("HumanoidRootPart") then
                local dist = (targetHRP.Position - myChar.HumanoidRootPart.Position).Magnitude
                if dist <= range and (not cooldownTable[player] or tick() - cooldownTable[player] >= COOLDOWN_TIME) then
                    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
                            if isAnimationMatching(track, animTable) then
                                cooldownTable[player] = tick()
                                task.spawn(function()
                                    local startTime = tick()
                                    while tick() - startTime < SPAM_DURATION do
                                        fireSkill(skillName)
                                        task.wait(0.05)
                                    end
                                end)
                                break
                            end
                        end
                    end
                end
            end
        end
    end
end
RunService.RenderStepped:Connect(function()
    if enabledRaging then
        detectAndSpam("RagingPace", RANGE_RAGING, activeCooldownsRaging, animsToDetectRaging)
    end
    if enabled404 then
        detectAndSpam("404Error", RANGE_404, activeCooldowns404, animsToDetect404)
    end
    if enabledCorrupt then
        detectAndSpam("CorruptEnergy", RANGE_CORRUPT, activeCooldownsCorrupt, animsToDetectCorrupt)
    end
end)

KillersTab:CreateToggle({
    Name = "Auto raging pace (parry)",
    CurrentValue = false,
    Flag = "RagingPaceToggle",
    Callback = function(Value)
        enabledRaging = Value
    end,
})
KillersTab:CreateInput({
    Name = "Auto raging pace range (studs)",
    Flag = "RagingPaceRangestuds",
    PlaceholderText = tostring(RANGE_RAGING),
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        local num = tonumber(Text)
        if num and num > 0 then
            RANGE_RAGING = num
            savedRangeRaging.Value = num
        end
    end,
})

KillersTab:CreateSection("John dough")

KillersTab:CreateToggle({
    Name = "Auto 404 parry",
    CurrentValue = false,
    Flag = "Error404Toggle",
    Callback = function(Value)
        enabled404 = Value
    end,
})
KillersTab:CreateInput({
    Name = "auto 404 parry range (studs)",
    Flag = "404ErrorRangestuds",
    PlaceholderText = tostring(RANGE_404),
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        local num = tonumber(Text)
        if num and num > 0 then
            RANGE_404 = num
            savedRange404.Value = num
        end
    end,
})
KillersTab:CreateToggle({
    Name = "Corrupt energy parry",
    CurrentValue = false,
    Flag = "CorruptEnergyToggle",
    Callback = function(Value)
        enabledCorrupt = Value
    end,
})
KillersTab:CreateInput({
    Name = "Corrupt energy parry range (studs)",
    Flag = "CorruptEnergyRangestuds",
    PlaceholderText = tostring(RANGE_CORRUPT),
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        local num = tonumber(Text)
        if num and num > 0 then
            RANGE_CORRUPT = num
            savedRangeCorrupt.Value = num
        end
    end,
})

local miscTab = Window:CreateTab("Misc")

miscTab:CreateSection("other things")

local TextChatService = game:GetService("TextChatService")

local chatVisible = true

Tabs.Misc:CreateToggle({
    Name = "Show chat visibility",
    CurrentValue = true,
    Callback = function(v)
        chatVisible = v
        local windowConfig = TextChatService:FindFirstChild("ChatWindowConfiguration")
        local inputBarConfig = TextChatService:FindFirstChild("ChatInputBarConfiguration")

        if windowConfig and inputBarConfig then
            windowConfig.Enabled = chatVisible
            inputBarConfig.Enabled = chatVisible
            print("sys.er: checksum unavailable", chatVisible)
        else
            warn("srn.syntax 0x2")
        end
    end
})

local Lighting = game:GetService("Lighting")
local originalSettings = {
    Brightness = Lighting.Brightness,
    ClockTime = Lighting.ClockTime,
    FogEnd = Lighting.FogEnd,
    Ambient = Lighting.Ambient
}
local fullBrightEnabled = false

MiscTab:CreateToggle({
    Name = "Full Bright",
    CurrentValue = false,
    Callback = function(v)
        fullBrightEnabled = v
        if v then
            Lighting.Brightness = 2
            Lighting.ClockTime = 14
            Lighting.FogEnd = 100000
            Lighting.Ambient = Color3.fromRGB(255,255,255)
        else
            Lighting.Brightness = originalSettings.Brightness
            Lighting.ClockTime = originalSettings.ClockTime
            Lighting.FogEnd = originalSettings.FogEnd
            Lighting.Ambient = originalSettings.Ambient
        end
    end
})

local originalFogStart = Lighting.FogStart
local originalFogEnd = Lighting.FogEnd

MiscTab:CreateToggle({
    Name = "Remove fog",
    CurrentValue = false,
    Callback = function(enabled)
        if enabled then
            Lighting.FogStart = 0
            Lighting.FogEnd = 100000
        else
            Lighting.FogStart = originalFogStart
            Lighting.FogEnd = originalFogEnd
        end
    end
})  